<!-- content_detail.html -->
{% extends "base.html" %}
{% block title %}{{ content_detail.title|default:"Content Detail" }}{% endblock %}
{% load custom_filters %}
{% load markdownify %}
{% load django_bootstrap5 %}
{% load static %}

{% block content %}

{% comment %} 
TODO: Add button to create post directly (automating thread step)
{% endcomment %}

<!-- Content and Detail Form -->
<div class="container" id="content-form">
    <h2><i class="bi bi-pencil-square"></i> Content Prompt and Detail</h2>
    
    <form method="post" action="{% url 'manage_content' %}" class="needs-validation" data-loading>
        {% csrf_token %}
        <div class="row">
            <!-- Content Form -->
            <div class="col-md-6">
                <div class="card mb-3">
                    <div class="card-header">
                        <h3 class="mb-0">Content Form</h3>
                    </div>
                    <div class="card-body">
                        {% bootstrap_form content_form %}
                    </div>
                </div>
            </div>
            
            <!-- Content Detail Form -->
            <div class="col-md-6">
                <div class="card mb-3">
                    <div class="card-header">
                        <h3 class="mb-0">Content Detail Form</h3>
                    </div>
                    <div class="card-body">
                        {% bootstrap_form content_detail_form %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="d-grid gap-2">
            {% if content_detail_id %}
                <!-- Save Button -->
                <button type="submit" class="btn btn-primary" id="save-btn" 
                        formaction="{% url 'edit_content' content_detail_id %}"
                        name="_method" value="save" disabled data-loading-text="Saving...">
                    <i class="bi bi-save"></i> Save Changes
                </button>
                
                <!-- Generate Content Button -->
                <form action="{% url 'generate_content' content_detail_id %}" method="POST" data-loading>
                    {% csrf_token %}
                    <input type="hidden" name="content_detail_id" value="{{ content_detail_id }}">
                    <input type="hidden" name="_method" value="generate_content">
                    <button type="submit" id="generate-btn" class="btn btn-success w-100" data-loading-text="Generating...">
                        <i class="bi bi-stars"></i> Generate Content
                    </button>
                </form>
                
                <!-- New Thread Button -->
                <form action="{% url 'create_thread' content_detail_id %}" method="POST">
                    {% csrf_token %}
                    <input type="hidden" name="content_detail_id" value="{{ content_detail_id }}">
                    <input type="hidden" name="_method" value="create_thread">
                    <button type="submit" class="btn btn-info w-100" id="thread-btn">
                        <i class="bi bi-chat-dots"></i> Create Thread
                    </button>
                </form>
                
                <!-- Delete Button -->
                <form action="{% url 'delete_content' content_detail_id %}" method="POST">
                    {% csrf_token %}
                    <input type="hidden" name="content_detail_id" value="{{ content_detail_id }}">
                    <input type="hidden" name="_method" value="delete">
                    <button type="button" class="btn btn-danger w-100 delete-btn"
                            data-bs-toggle="modal"
                            data-bs-target="#confirmModal"
                            data-confirm-message="Are you sure you want to delete this content?">
                        <i class="bi bi-trash"></i> Delete
                    </button>
                </form>
                
                <!-- Create New Record Button -->
                <a href="{% url 'manage_content' %}" class="btn btn-outline-secondary">
                    <i class="bi bi-file-plus"></i> Create New Record
                </a>
            {% else %}
                <!-- Create Button -->
                <button type="submit" class="btn btn-primary" name="_method" value="save">
                    <i class="bi bi-plus-circle"></i> Create Content
                </button>
            {% endif %}
        </div>
    </form>
</div>

<!-- Content List -->
<div class="container mt-5">
    <h2><i class="bi bi-list-ul"></i> Content List</h2>
    {% render_model_table content_detail_info fields display_fields 'content_detail' 'Content Listing' %}
</div>

<script src="{% static 'js/content_detail.js' %}"></script>

{% endblock %}
