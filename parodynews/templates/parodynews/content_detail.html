<!-- content_detail.html -->
{% extends "base.html" %}
{% load markdownify %}

{% block content %}

<!-- Content Detail Form -->
<div class="container mt-4" id="content-create">
    <h2>Content Detail and Prompt</h2>
    {% if selected_content %}
    <form method="post" action="{% url 'content_detail' content_id=selected_content.id %}">
    {% else %}
    <form method="post" action="{% url 'manage_content' %}">
    {% endif %}
        {% csrf_token %}
        <div class="row">
            <!-- Content Detail Section -->
            <div class="col-md-6">
                <h3>Content Detail</h3>
                <div class="form-group">
                    {{ content_detail_form.as_p }}
                    <button type="submit" class="btn btn-primary">Save</button>
                </div>
                
            </div>
            <!-- Content and Prompt Section -->
            <div class="col-md-6">
                <h3>Content and Prompt</h3>
                <div class="form-group">
                    {{ assistant_form.as_p }}
                </div>
                <div class="form-group">
                    {{ content_form.as_p }}
                </div>
            </div>
        </div>
        <button type="submit" class="btn btn-primary mt-3">Generate Content</button>
    </form>
</div>
<!-- Content List -->
<div class="container mp-3">
    <h2>Content List</h2>
    <table class="table" id="content-table">
        <thead>
            <tr>
                <th>ID</th>
                <th>Title</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for item in content_with_details %}
            <tr>
                <td>
                    {{ item.content.detail.id }}
                </td>
                <td>
                    <a href="{% url 'content_detail' item.content.id %}#selected-content">{{ item.content_detail.title }}</a>
                </td>
                <td>
                    <div class="d-flex justify-content-end">
                        <!-- Delete Button Form -->
                        <form action="{% url 'manage_content' %}" method="post" class="delete-form mr-2">
                            {% csrf_token %}
                            <input type="hidden" name="content_id" value="{{ item.content.id }}">
                            <input type="hidden" name="_method" value="delete">
                            <input type="hidden" name="action" value="delete">
                            <button type="submit" class="btn btn-danger" onclick="return confirm('Are you sure you want to delete this content?');">Delete</button>
                        </form>
                        <!-- Create Message Button -->
                        <form action="{% url 'create_message' %}" method="POST">
                            {% csrf_token %}
                            <input type="hidden" name="content_id" value="{{ item.content.id }}">
                            <button type="submit" class="btn btn-primary">Create New Message</button>
                        </form>
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>


{% load static %}
<script src="{% static 'js/content_detail.js' %}"></script>

<script>
    function generateMarkdownFile(contentId) {
        window.location.href = "{% url 'generate_markdown' %}?content_id=" + contentId;
    }
</script>
{% endblock %}
